generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model Usuario {
  id                  String               @id
  nome                String               @db.VarChar(255)
  telefone            String?              @db.VarChar(50)
  email               String               @unique @db.VarChar(255)
  cpfCnpj             String?              @map("cpf_cnpj") @db.VarChar(20)
  observacoes         String?
  role                String               @default("user") @db.VarChar(20)
  tema                String               @db.VarChar(20)
  idioma              String               @db.VarChar(10)
  endereco            Json                 @default("[]")
  receberNotificacoes Boolean              @default(true) @map("receber_notificacoes")
  expoPushToken       String?              @map("expo_push_token")
  criadoEm            DateTime             @default(now()) @map("criado_em") @db.Timestamptz(6)
  atualizadoEm        DateTime             @default(now()) @updatedAt @map("atualizado_em") @db.Timestamptz(6)
  avatarUrl           String?              @map("avatar_url") @db.VarChar(500)
  clientePedidoDireto ClientePedidoDireto?
  pedidosDiretos      PedidoDireto[]
  pedidosEncomenda    PedidoEncomenda[]
  vendasCriadas       Venda[]              @relation("VendaCriador")
  vendas              Venda[]
  notificacoes        Notificacao[]

  @@map("usuarios")
}

model Categoria {
  id       Int      @id @default(autoincrement())
  nome     Json     @db.Json
  ordem    Int      @default(0)
  criadoEm DateTime @default(now()) @map("criado_em") @db.Timestamptz(6)

  @@map("categorias")
}

model Produto {
  id                   Int                   @id @default(autoincrement())
  nome                 Json                  @db.Json
  preco                Decimal?              @db.Decimal(10, 2)
  ingredientes         Json?                 @db.Json
  quantidade           Int?                  @default(1)
  categoria            Json                  @db.Json
  observacoes          Json?                 @db.Json
  imagem               String?               @db.VarChar(500)
  abreviacao           String?               @db.VarChar(50)
  ativo                Boolean               @default(true)
  criadoEm             DateTime              @default(now()) @map("criado_em") @db.Timestamptz(6)
  atualizadoEm         DateTime              @default(now()) @updatedAt @map("atualizado_em") @db.Timestamptz(6)
  itensPedidoDireto    ItemPedidoDireto[]
  itensPedidoEncomenda ItemPedidoEncomenda[]
  itensVenda           ItemVenda[]
  produtosEncomenda    ProdutoEncomenda[]
  produtosPedidoDireto ProdutoPedidoDireto[]
  variedades           VariedadeProduto[]

  @@map("produtos")
}

model VariedadeProduto {
  id           Int      @id @default(autoincrement())
  produtoId    Int      @map("produto_id")
  nome         Json     @db.Json
  preco        Decimal  @db.Decimal(10, 2)
  ingredientes Json?    @db.Json
  quantidade   Int?     @default(1)
  ativo        Boolean  @default(true)
  imagem       String?  @db.VarChar(500)
  criadoEm     DateTime @default(now()) @map("criado_em") @db.Timestamptz(6)
  atualizadoEm DateTime @default(now()) @updatedAt @map("atualizado_em") @db.Timestamptz(6)

  produto Produto @relation(fields: [produtoId], references: [id], onDelete: Cascade)

  itensPedidoDireto    ItemPedidoDireto[]
  itensPedidoEncomenda ItemPedidoEncomenda[]
  itensVenda           ItemVenda[]
  produtosEncomenda    ProdutoEncomenda[]
  variedadesPedidoDireto VariedadePedidoDireto[]

  @@map("variedades_produto")
}

model Venda {
  id                 Int            @id @default(autoincrement())
  usuarioId          String?        @map("usuario_id")
  data               DateTime       @default(now()) @db.Timestamptz(6)
  total              Decimal        @db.Decimal(10, 2)
  observacoes        String?
  descontoGeralTipo  String?        @map("desconto_geral_tipo") @db.VarChar(20)
  descontoGeralValor Decimal        @default(0) @map("desconto_geral_valor") @db.Decimal(10, 2)
  criadoPor          String?        @map("criado_por")
  criadoEm           DateTime       @default(now()) @map("criado_em") @db.Timestamptz(6)
  itens              ItemVenda[]
  pedidos              PedidoDireto[]
  pedidosEncomenda     PedidoEncomenda[]
  criador              Usuario?       @relation("VendaCriador", fields: [criadoPor], references: [id])
  usuario              Usuario?       @relation(fields: [usuarioId], references: [id])

  @@map("vendas")
}

model ItemVenda {
  id            Int               @id @default(autoincrement())
  vendaId       Int               @map("venda_id")
  produtoId     Int               @map("produto_id")
  variedadeId   Int?              @map("variedade_id")
  quantidade    Int
  precoUnitario Decimal           @map("preco_unitario") @db.Decimal(10, 2)
  tipoDesconto  String?           @map("tipo_desconto") @db.VarChar(20)
  valorDesconto Decimal           @default(0) @map("valor_desconto") @db.Decimal(10, 2)
  produto       Produto           @relation(fields: [produtoId], references: [id])
  variedade     VariedadeProduto? @relation(fields: [variedadeId], references: [id])
  venda         Venda             @relation(fields: [vendaId], references: [id], onDelete: Cascade)

  @@map("itens_venda")
}

model DataEncomenda {
  id                     Int                     @id @default(autoincrement())
  dataEntrega            DateTime                @map("data_entrega") @db.Date
  dataLimitePedido       DateTime                @map("data_limite_pedido") @db.Timestamptz(6)
  ativo                  Boolean                 @default(true)
  concluido              Boolean                 @default(false)
  observacoes            String?
  criadoEm               DateTime                @default(now()) @map("criado_em") @db.Timestamptz(6)
  enderecosEspeciais     Json?                   @map("enderecos_especiais")
  entregadorLocalizacoes EntregadorLocalizacao[]
  entregasConcluidas     EntregaConcluida[]
  pedidosEncomenda       PedidoEncomenda[]
  produtosEncomenda      ProdutoEncomenda[]
  rotaEntrega            RotaEntrega?
  notificacoes           Notificacao[]

  @@map("datas_encomenda")
}

model ProdutoEncomenda {
  id              Int               @id @default(autoincrement())
  dataEncomendaId Int               @map("data_encomenda_id")
  produtoId       Int               @map("produto_id")
  variedadeId     Int?              @map("variedade_id")
  ativo           Boolean           @default(true)
  dataEncomenda   DataEncomenda     @relation(fields: [dataEncomendaId], references: [id], onDelete: Cascade)
  produto         Produto           @relation(fields: [produtoId], references: [id])
  variedade       VariedadeProduto? @relation(fields: [variedadeId], references: [id])

  @@unique([dataEncomendaId, produtoId, variedadeId])
  @@map("produtos_encomenda")
}

model PedidoEncomenda {
  id                      Int                   @id @default(autoincrement())
  codigo                  String?               @unique @db.VarChar(10)
  usuarioId               String                @map("usuario_id")
  dataEncomendaId         Int                   @map("data_encomenda_id")
  dataPedido              DateTime              @default(now()) @map("data_pedido") @db.Timestamptz(6)
  talheres                Int                   @default(0)
  observacoes             String?
  formaPagamento          String?               @map("forma_pagamento") @db.VarChar(50)
  tipoEntrega             String?               @map("tipo_entrega") @db.VarChar(20)
  taxaEntrega             Decimal               @default(0) @map("taxa_entrega") @db.Decimal(10, 2)
  totalValor              Decimal               @default(0) @map("total_valor") @db.Decimal(10, 2)
  statusPagamento         String                @default("pendente") @map("status_pagamento") @db.VarChar(30)
  statusPagamentoAnterior String?               @map("status_pagamento_anterior") @db.VarChar(30)
  emEntrega               Boolean               @default(false) @map("em_entrega")
  dataPagamento           DateTime?             @map("data_pagamento") @db.Timestamptz(6)
  confirmadoPor           String?               @map("confirmado_por")
  emailConfirmacaoEnviado Boolean               @default(false) @map("email_confirmacao_enviado")
  horarioEstimadoEntrega  DateTime?             @map("horario_estimado_entrega") @db.Timestamptz(6)
  enderecoEntrega         Json?                 @map("endereco_entrega")
  enderecoEspecialNome    String?               @map("endereco_especial_nome") @db.VarChar(255)
  precisaTalheres         Boolean               @default(false) @map("precisa_talheres")
  comprovanteUrl          String?               @map("comprovante_url") @db.VarChar(1000)
  vendaId                 Int?                  @map("venda_id")
  itens                   ItemPedidoEncomenda[]
  dataEncomenda           DataEncomenda         @relation(fields: [dataEncomendaId], references: [id])
  usuario                 Usuario               @relation(fields: [usuarioId], references: [id])
  venda                   Venda?                @relation(fields: [vendaId], references: [id])
  notificacoes            Notificacao[]

  @@unique([usuarioId, dataEncomendaId])
  @@map("pedidos_encomenda")
}

model ItemPedidoEncomenda {
  id            Int               @id @default(autoincrement())
  pedidoId      Int               @map("pedido_id")
  produtoId     Int               @map("produto_id")
  variedadeId   Int?              @map("variedade_id")
  quantidade    Int
  precoUnitario Decimal?          @map("preco_unitario") @db.Decimal(10, 2)
  pedido        PedidoEncomenda   @relation(fields: [pedidoId], references: [id], onDelete: Cascade)
  produto       Produto           @relation(fields: [produtoId], references: [id])
  variedade     VariedadeProduto? @relation(fields: [variedadeId], references: [id])

  @@map("itens_pedido_encomenda")
}

model ClientePedidoDireto {
  id           Int      @id @default(autoincrement())
  usuarioId    String   @unique @map("usuario_id")
  habilitado   Boolean  @default(false)
  criadoEm     DateTime @default(now()) @map("criado_em") @db.Timestamptz(6)
  atualizadoEm DateTime @default(now()) @updatedAt @map("atualizado_em") @db.Timestamptz(6)
  usuario      Usuario  @relation(fields: [usuarioId], references: [id], onDelete: Cascade)

  @@map("clientes_pedido_direto")
}

model ProdutoPedidoDireto {
  id           Int      @id @default(autoincrement())
  produtoId    Int      @map("produto_id")
  usuarioId    String?  @map("usuario_id")
  habilitado   Boolean  @default(false)
  criadoEm     DateTime @default(now()) @map("criado_em") @db.Timestamptz(6)
  atualizadoEm DateTime @default(now()) @updatedAt @map("atualizado_em") @db.Timestamptz(6)
  produto      Produto  @relation(fields: [produtoId], references: [id])

  @@map("produtos_pedido_direto")
}

model VariedadePedidoDireto {
  id           Int      @id @default(autoincrement())
  variedadeId  Int      @unique @map("variedade_id")
  habilitado   Boolean  @default(false)
  criadoEm     DateTime @default(now()) @map("criado_em") @db.Timestamptz(6)
  atualizadoEm DateTime @default(now()) @updatedAt @map("atualizado_em") @db.Timestamptz(6)

  variedade VariedadeProduto @relation(fields: [variedadeId], references: [id], onDelete: Cascade)

  @@map("variedades_pedido_direto")
}

model PedidoDireto {
  id            Int                @id @default(autoincrement())
  codigo        String?            @unique @db.VarChar(10)
  usuarioId     String             @map("usuario_id")
  dataPedido    DateTime           @default(now()) @map("data_pedido") @db.Timestamptz(6)
  dataEntrega   DateTime           @map("data_entrega") @db.Date
  observacoes   String?
  totalValor    Decimal            @default(0) @map("total_valor") @db.Decimal(10, 2)
  status        String             @default("pendente") @db.VarChar(20)
  confirmadoEm  DateTime?          @map("confirmado_em") @db.Timestamptz(6)
  confirmadoPor String?            @map("confirmado_por")
  entregueEm    DateTime?          @map("entregue_em") @db.Timestamptz(6)
  entreguePor   String?            @map("entregue_por")
  vendaId       Int?               @map("venda_id")
  itens         ItemPedidoDireto[]
  usuario       Usuario            @relation(fields: [usuarioId], references: [id])
  venda         Venda?             @relation(fields: [vendaId], references: [id])
  notificacoes  Notificacao[]

  @@map("pedidos_diretos")
}

model ItemPedidoDireto {
  id            Int               @id @default(autoincrement())
  pedidoId      Int               @map("pedido_id")
  produtoId     Int               @map("produto_id")
  variedadeId   Int?              @map("variedade_id")
  quantidade    Int
  precoUnitario Decimal           @map("preco_unitario") @db.Decimal(10, 2)
  subtotal      Decimal           @db.Decimal(10, 2)
  pedido        PedidoDireto      @relation(fields: [pedidoId], references: [id], onDelete: Cascade)
  produto       Produto           @relation(fields: [produtoId], references: [id])
  variedade     VariedadeProduto? @relation(fields: [variedadeId], references: [id])

  @@map("itens_pedido_direto")
}

model RotaEntrega {
  id              Int           @id @default(autoincrement())
  formId          Int           @unique @map("form_id")
  links           Json          @default("[]")
  horariosChegada Json?         @map("horarios_chegada")
  nomesParadas    Json?         @map("nomes_paradas")
  criadoEm        DateTime      @default(now()) @map("criado_em") @db.Timestamptz(6)
  dataEncomenda   DataEncomenda @relation(fields: [formId], references: [id])

  @@map("rotas_entrega")
}

model EntregadorLocalizacao {
  id            Int           @id @default(autoincrement())
  formId        Int           @map("form_id")
  latitude      Decimal       @db.Decimal(10, 8)
  longitude     Decimal       @db.Decimal(11, 8)
  courierId     Int?          @map("courier_id")
  atualizadoEm  DateTime      @default(now()) @map("atualizado_em") @db.Timestamptz(6)
  dataEncomenda DataEncomenda @relation(fields: [formId], references: [id])

  @@map("entregador_localizacao")
}

model EntregaConcluida {
  id            Int           @id @default(autoincrement())
  formId        Int           @map("form_id")
  paradaIdx     Int           @map("parada_idx")
  concluidaEm   DateTime      @default(now()) @map("concluida_em") @db.Timestamptz(6)
  dataEncomenda DataEncomenda @relation(fields: [formId], references: [id])

  @@unique([formId, paradaIdx])
  @@map("entregas_concluidas")
}

model NotaDespesa {
  id                    Int           @id @default(autoincrement())
  nomeEstabelecimento   String?       @map("nome_estabelecimento") @db.VarChar(255)
  dataCompra            DateTime?     @map("data_compra") @db.Timestamptz(6)
  valorTotal            Decimal?      @map("valor_total") @db.Decimal(10, 2)
  valorTotalSemDesconto Decimal?      @map("valor_total_sem_desconto") @db.Decimal(10, 2)
  valorDesconto         Decimal       @default(0) @map("valor_desconto") @db.Decimal(10, 2)
  foiEditada            Boolean       @default(false) @map("foi_editada")
  urlQrcode             String?       @map("url_qrcode") @db.VarChar(1000)
  xmlRaw                String?       @map("xml_raw")
  criadoEm      DateTime      @default(now()) @map("criado_em") @db.Timestamptz(6)
  itens         ItemDespesa[]

  @@map("notas_despesa")
}

model ItemDespesa {
  id            Int         @id @default(autoincrement())
  notaId        Int         @map("nota_id")
  descricao     String?     @db.VarChar(500)
  quantidade    Decimal?    @db.Decimal(12, 4)
  valorUnitario Decimal?    @map("valor_unitario") @db.Decimal(10, 2)
  valor         Decimal?    @db.Decimal(10, 2)
  nota          NotaDespesa @relation(fields: [notaId], references: [id], onDelete: Cascade)

  @@map("itens_despesa")
}

model EmailLog {
  id            Int       @id @default(autoincrement())
  destinatario  String    @db.VarChar(255)
  assunto       String    @db.VarChar(500)
  status        String    @db.VarChar(20)
  erro          String?
  tentativas    Int       @default(1)
  criadoEm      DateTime  @default(now()) @map("criado_em") @db.Timestamptz(6)
  enviadoEm     DateTime? @map("enviado_em") @db.Timestamptz(6)
  tipoEmail     String?   @map("tipo_email") @db.VarChar(50)
  corpoHtml     String?   @map("corpo_html")
  corpoTexto    String?   @map("corpo_texto")
  dadosTemplate Json?     @map("dados_template")

  @@map("email_logs")
}

model ActivityLog {
  id           Int      @id @default(autoincrement())
  usuarioId    String?  @map("usuario_id")
  nomeUsuario  String?  @map("nome_usuario") @db.VarChar(255)
  emailUsuario String?  @map("email_usuario") @db.VarChar(255)
  atividade    String   @db.VarChar(100)
  detalhes     String?
  criadoEm     DateTime @default(now()) @map("criado_em") @db.Timestamptz(6)

  @@map("activity_logs")
}

model CodigoRecuperacao {
  id       Int      @id @default(autoincrement())
  email    String   @db.VarChar(255)
  codigo   String   @db.VarChar(6)
  expiraEm DateTime @map("expira_em") @db.Timestamptz(6)
  criadoEm DateTime @default(now()) @map("criado_em") @db.Timestamptz(6)

  @@index([email])
  @@map("codigos_recuperacao")
}

model ConfiguracaoFormularios {
  id                      Int      @id @default(1)
  chavePix                String?  @map("chave_pix") @db.VarChar(255)
  tipoChavePix            String?  @map("tipo_chave_pix") @db.VarChar(50)
  nomeRecebedor           String?  @map("nome_recebedor") @db.VarChar(25)
  cidadeRecebedor         String?  @map("cidade_recebedor") @db.VarChar(15)
  taxaEntregaBase         Decimal  @default(12.00) @map("taxa_entrega_base") @db.Decimal(10, 2)
  valorMinimoTaxaReduzida Decimal  @default(100.00) @map("valor_minimo_taxa_reduzida") @db.Decimal(10, 2)
  taxaEntregaReduzida     Decimal  @default(8.00) @map("taxa_entrega_reduzida") @db.Decimal(10, 2)
  valorMinimoIsencao      Decimal  @default(130.00) @map("valor_minimo_isencao") @db.Decimal(10, 2)
  enderecosEspeciais      Json     @default("[]") @map("enderecos_especiais")
  enderecoRestaurante     Json?    @map("endereco_restaurante")
  atualizadoEm            DateTime @default(now()) @updatedAt @map("atualizado_em") @db.Timestamptz(6)

  @@map("configuracao_formularios")
}

model Notificacao {
  id                String   @id @default(uuid())
  usuarioId         String   @map("usuario_id")
  titulo            String   @db.VarChar(255)
  mensagem          String
  dataEncomendaId   Int?     @map("data_encomenda_id")
  pedidoDiretoId    Int?     @map("pedido_direto_id")
  pedidoEncomendaId Int?     @map("pedido_encomenda_id")
  tipo              String   @default("user") @db.VarChar(20)
  lido              Boolean  @default(false)
  criadoEm          DateTime @default(now()) @map("criado_em") @db.Timestamptz(6)

  usuario         Usuario          @relation(fields: [usuarioId], references: [id], onDelete: Cascade)
  dataEncomenda   DataEncomenda?   @relation(fields: [dataEncomendaId], references: [id])
  pedidoDireto    PedidoDireto?    @relation(fields: [pedidoDiretoId], references: [id])
  pedidoEncomenda PedidoEncomenda? @relation(fields: [pedidoEncomendaId], references: [id])

  @@map("notificacoes")
}
